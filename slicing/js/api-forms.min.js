$(function(){window.actions={};$("button[data-callback], button[data-callback]").on("click",function(b){console.log("clicked!");var a=$(this).data("callback");window.actions[a](this);b.preventDefault()});$("form[data-target='api'] .form-control").on("input",function(){$(this).closest("form").find(".form-error").hide();var a=$(this).closest(".form-group");a.removeClass("has-error");a.removeClass("has-success");a.find(".error-message").text("")});$("form[data-target='api']").on("submit",function(a){a.preventDefault();var b=$(this).find("button[type=submit]");b.button();b.button("loading");var c=this;$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),dataType:"json",}).done(function(e){$(c).find("[data-done-text]").each(function(){$(this).html($(this).data("done-text"))});var f=$(c).data("redirect");var d=$(c).data("callback");if(d){window.actions[d](e)}if(f){f=f.replace(/\{([a-zA-Z0-9]+)\}/g,function(g,h){return e[h]});console.log(e,f);window.location.replace(f+window.location.hash);b.hide()}else{b.button("reset")}}).fail(function(d){if(d.responseJSON){if(d.responseJSON.responseStatus.message){var e=$(c).find(".form-error");e.html(d.responseJSON.responseStatus.message);e.show()}if(d.responseJSON.responseStatus.errors.length>0){$.each(d.responseJSON.responseStatus.errors,function(i,g){var h=$(c).find("[name='"+g.fieldName.substring(0,1).toLowerCase()+g.fieldName.substring(1)+"']").closest(".form-group");h.addClass("has-error");var f=h.find(".error-message").text(g.message)});$(c).find(".form-group").each(function(){var f=$(this);if(!f.hasClass("has-error")){f.addClass("has-success")}})}}else{console.log(d)}b.button("reset")}).always(function(){})})});